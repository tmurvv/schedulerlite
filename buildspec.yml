version: 0.2

phases:
  install:
    commands:
      - npm install -g pnpm
      - pnpm --version

      # Install Node 20 on Ubuntu-based CodeBuild image
      - curl -fsSL https://deb.nodesource.com/setup_20.x | bash -
      - apt-get install -y nodejs
      - node --version

      - pnpm install

  build:
    commands:
      - echo "Backend scheduler - NYI"
      - echo "Building backend - timesheets"
      - cd apps/backend/timesheets
      - pnpm build
      - cd ../../..

      - echo "Frontend scheduler - NYI"
      - echo "Building frontend - timesheets"
      - cd apps/frontend/timesheets
      - pnpm build
      - cd ../../..

      - echo "Synthesizing CDK"
      - pnpm exec cdk synth --output dist/cdk

artifacts:
  files:
    - '**/*'
  base-directory: dist/cdk
